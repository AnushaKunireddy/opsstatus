"use strict";jQuery(document).ready(function(e){if(e(".admin-sd > li").on("click",function(e){window.location.assign(e.currentTarget.dataset.link)}),e("#admin-components").length){if(e("#admin-components > .admin-headlist").length){Sortable.create(e("#admin-components > .admin-headlist").get(0),{group:"master",animation:300,chosenClass:"active",handle:".handle",onEnd:function(e){}}),_.map(e("#admin-components > .admin-headlist .admin-list"),function(e){return Sortable.create(e,{group:"child",animation:300,chosenClass:"active",handle:".handle",onEnd:function(e){}})})}if(e("#admin-components > .admin-prelist").length){Sortable.create(e("#admin-components > .admin-prelist .admin-list").get(0),{group:{name:"child",pull:!0,put:!1},animation:300,chosenClass:"active",handle:".handle",onEnd:function(e){}})}e("#admin-components-new").on("click",function(n){vex.dialog.open({message:"Enter the info of the new component:",input:'<input name="name" type="text" placeholder="Component Name" autocomplete="off" pattern=".{3,}" required /><input name="description" type="text" placeholder="Short description" autocomplete="off" pattern=".{5,}" required />',callback:function(n){_.isPlainObject(n)&&e.ajax("/admin/components",{dataType:"json",method:"PUT",data:{name:n.name,description:n.description}}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("Could not create component","Invalid component name.")},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})}),e("#admin-components-newgroup").on("click",function(n){vex.dialog.open({message:"Enter the info of the new component group:",input:'<input name="name" type="text" placeholder="Component Group Name" autocomplete="off" pattern=".{2,255}" required /><input name="shortname" type="text" placeholder="Component Group Short Name" autocomplete="off" pattern=".{2,20}" required />',callback:function(n){_.isPlainObject(n)&&e.ajax("/admin/componentgroups",{dataType:"json",method:"PUT",data:{name:n.name,shortname:n.shortname}}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("Could not create component group","Invalid component group name.")},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})}),e("#admin-regions > .admin-list > li .edit-action").on("click",function(n){var t=e(n.currentTarget).closest("li").get(0);vex.dialog.prompt({message:"Enter a new name for region "+t.dataset.name+":",placeholder:"Region name",value:t.dataset.name,callback:function(n){_.isEmpty(n)||e.ajax("/admin/regions",{dataType:"json",method:"POST",data:{editRegionId:t.dataset.id,editRegionName:n}}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("Edit region failed","Could not edit region. Try again later.")},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})}),e("#admin-regions > .admin-list > li .delete-action").on("click",function(n){var t=e(n.currentTarget).closest("li").get(0);vex.dialog.confirm({message:"Are you sure you want to delete region "+t.dataset.name+"?",callback:function(n){n&&e.ajax("/admin/regions",{dataType:"json",method:"DELETE",data:{regionId:t.dataset.id,regionName:t.dataset.name}}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("Delete region failed","Could not delete region. Try again later.")},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})})}if(e("#admin-regions").length){if(e("#admin-regions > .admin-list").length)var n=Sortable.create(e("#admin-regions > .admin-list").get(0),{animation:300,chosenClass:"active",handle:".handle",onEnd:function(t){e.ajax("/admin/regions",{dataType:"json",method:"POST",data:{regionOrder:JSON.stringify(n.toArray())}}).then(function(e){e.ok===!0?alerts.pushSuccess("New order saved.","The new regions sort order has been saved."):alerts.pushError("Re-ordering failed.","Could not re-order regions. Try again later.")},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}});e("#admin-regions-new").on("click",function(n){vex.dialog.prompt({message:"Enter the name of the new region:",placeholder:"Region name",callback:function(n){_.isEmpty(n)||e.ajax("/admin/regions",{dataType:"json",method:"PUT",data:{newRegionName:n}}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("Could not create region","Invalid region name.")},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})}),e("#admin-regions > .admin-list > li .edit-action").on("click",function(n){var t=e(n.currentTarget).closest("li").get(0);vex.dialog.prompt({message:"Enter a new name for region "+t.dataset.name+":",placeholder:"Region name",value:t.dataset.name,callback:function(n){_.isEmpty(n)||e.ajax("/admin/regions",{dataType:"json",method:"POST",data:{editRegionId:t.dataset.id,editRegionName:n}}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("Edit region failed","Could not edit region. Try again later.")},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})}),e("#admin-regions > .admin-list > li .delete-action").on("click",function(n){var t=e(n.currentTarget).closest("li").get(0);vex.dialog.confirm({message:"Are you sure you want to delete region "+t.dataset.name+"?",callback:function(n){n&&e.ajax("/admin/regions",{dataType:"json",method:"DELETE",data:{regionId:t.dataset.id,regionName:t.dataset.name}}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("Delete region failed","Could not delete region. Try again later.")},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})})}e("#admin-users").length&&(e("#admin-users-new").on("click",function(n){vex.dialog.open({message:"Enter new user info:",input:'<input name="email" type="text" placeholder="Email Address" autocomplete="email" pattern="[^@]+@[^@]+" required /><input name="password" type="text" placeholder="Password (min 8 chars.)" autocomplete="off" pattern=".{8,}" required /><input name="firstName" type="text" placeholder="First Name" autocomplete="given-name" pattern=".+" required /><input name="lastName" type="text" placeholder="Last Name" autocomplete="family-name" pattern=".+" required />',callback:function(n){_.isPlainObject(n)&&e.ajax("/admin/users",{dataType:"json",method:"PUT",data:n}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("User creation error",e.error.message||e.error)},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})}),e("#admin-users .admin-list > li .edit-action").on("click",function(n){var t=e(n.currentTarget).closest("li").get(0);vex.dialog.open({message:"Edit basic info for "+t.dataset.email+":",input:'<input name="email" type="text" placeholder="Email Address" value="'+t.dataset.email+'" autocomplete="email" pattern="[^@]+@[^@]+" required /><input name="password" type="password" value="********" autocomplete="off" pattern=".{8,}" required /><input name="firstName" type="text" placeholder="First Name" value="'+t.dataset.firstname+'" autocomplete="given-name" pattern=".+" required /><input name="lastName" type="text" placeholder="Last Name" value="'+t.dataset.lastname+'" autocomplete="family-name" pattern=".+" required />',callback:function(n){_.isPlainObject(n)&&e.ajax("/admin/users",{dataType:"json",method:"POST",data:{id:t.dataset.id,data:JSON.stringify(n)}}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("Edit user failed",e.error.message||e.error)},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})}),e("#admin-users .admin-list > li .delete-action").on("click",function(n){var t=e(n.currentTarget).closest("li").get(0);vex.dialog.confirm({message:"Are you sure you want to delete user "+t.dataset.email+"?",callback:function(n){n&&e.ajax("/admin/users",{dataType:"json",method:"DELETE",data:{id:t.dataset.id,email:t.dataset.email}}).then(function(e){e.ok===!0?window.location.reload(!0):alerts.pushError("Delete user failed",e.error.message||e.error)},function(){alerts.pushError("Connection error","An unexpected error when connecting to the server.")})}})}))});